---
import MainLayout from '../layouts/MainLayout.astro';
import SectionWrapper from '../components/layout/SectionWrapper.astro';

const title = 'Bewerbung – Operation Zündkapsel';
const description = 'Bewirb dich für eines der 10 Gründer‑Mandate: 12‑monatiges strategisches Bündnis für deinen Sieg gegen Konzerne, Versicherer oder Behörden.';
---
<MainLayout title={title} description={description}>
  <SectionWrapper variant="accent">
    <h1 class="text-3xl md:text-4xl font-bold mb-6">Bewerbung – Operation Zündkapsel</h1>
    <p class="text-gray-300 mb-8">
      Bewirb dich auf einen der 10 Plätze. Konzentriere dich auf Klarheit: Wo stehst du, was ist dein Ziel, und warum bist du der richtige Kandidat?
    </p>

    <form
      action="https://formspree.io/f/xandgpzd"
      method="POST"
      class="grid gap-6 max-w-3xl"
      id="bewerbungForm"
      novalidate
    >
      <!-- Redirect nach Erfolg -->
      <input type="hidden" name="_next" value="/bewerbung/danke" />
      <!-- Honeypot -->
      <div class="hidden">
        <label>Website (nicht ausfüllen)
          <input type="text" name="website" autocomplete="off" />
        </label>
      </div>
      <!-- Time trap -->
      <input type="hidden" name="form_start_ms" id="form_start_ms" />

      <div class="grid gap-4 md:grid-cols-2">
        <div>
          <label for="vorname" class="block text-sm text-gray-300 mb-1">Vorname<span class="text-red-400">*</span></label>
          <input id="vorname" name="vorname" required autocomplete="given-name" class="w-full rounded-md bg-gray-800/60 border border-gray-700 px-4 py-2 text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-brand-orange" />
        </div>
        <div>
          <label for="nachname" class="block text-sm text-gray-300 mb-1">Nachname<span class="text-red-400">*</span></label>
          <input id="nachname" name="nachname" required autocomplete="family-name" class="w-full rounded-md bg-gray-800/60 border border-gray-700 px-4 py-2 text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-brand-orange" />
        </div>
      </div>

      <div class="grid gap-4 md:grid-cols-2">
        <div>
          <label for="email" class="block text-sm text-gray-300 mb-1">E‑Mail<span class="text-red-400">*</span></label>
          <input id="email" type="email" name="email" required autocomplete="email" class="w-full rounded-md bg-gray-800/60 border border-gray-700 px-4 py-2 text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-brand-orange" />
        </div>
        <div>
          <label for="telegram" class="block text-sm text-gray-300 mb-1">Telegram (optional)</label>
          <input id="telegram" name="telegram" placeholder="@deinhandle" class="w-full rounded-md bg-gray-800/60 border border-gray-700 px-4 py-2 text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-brand-orange" />
        </div>
      </div>

      <div>
        <label for="gegner" class="block text-sm text-gray-300 mb-1">Gegner (Firma/Versicherung/Behörde)<span class="text-red-400">*</span></label>
        <input id="gegner" name="gegner" required class="w-full rounded-md bg-gray-800/60 border border-gray-700 px-4 py-2 text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-brand-orange" />
      </div>

      <div>
        <label for="fall" class="block text-sm text-gray-300 mb-1">Fall‑Kurzfassung (5–10 Sätze)<span class="text-red-400">*</span></label>
        <textarea id="fall" name="fall" required rows="6" class="w-full rounded-md bg-gray-800/60 border border-gray-700 px-4 py-2 text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-brand-orange"></textarea>
      </div>

      <div>
        <label for="ziel12" class="block text-sm text-gray-300 mb-1">Ziel in 12 Monaten<span class="text-red-400">*</span></label>
        <textarea id="ziel12" name="ziel12" required rows="4" class="w-full rounded-md bg-gray-800/60 border border-gray-700 px-4 py-2 text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-brand-orange"></textarea>
      </div>

      <div>
        <label for="bisher" class="block text-sm text-gray-300 mb-1">Was hast du bereits versucht? (optional)</label>
        <textarea id="bisher" name="bisher" rows="3" class="w-full rounded-md bg-gray-800/60 border border-gray-700 px-4 py-2 text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-brand-orange"></textarea>
      </div>

      <div>
        <label for="doku_link" class="block text-sm text-gray-300 mb-1">Link zu Unterlagen (optional)</label>
        <input id="doku_link" type="url" name="doku_link" placeholder="https://…" class="w-full rounded-md bg-gray-800/60 border border-gray-700 px-4 py-2 text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-brand-orange" />
      </div>

      <div class="space-y-3">
        <label class="inline-flex items-start gap-3" for="commit_testimonial">
          <input id="commit_testimonial" type="checkbox" name="commit_testimonial" required class="mt-1" />
          <span class="text-gray-300">Ich bestätige mein Commitment für ein schonungsloses Video‑Testimonial nach meinem Sieg.<span class="text-red-400">*</span></span>
        </label>
        <label class="inline-flex items-start gap-3" for="privacy">
          <input id="privacy" type="checkbox" name="privacy" required class="mt-1" />
          <span class="text-gray-300">Ich habe die <a href="/datenschutz" class="underline hover:text-white">Datenschutz</a> gelesen.<span class="text-red-400">*</span></span>
        </label>
      </div>

      <!-- Optionale Mini-Mathe-Aufgabe (Client-seitig) -->
      <div id="captchaBlock" class="grid gap-2">
        <label for="captchaAnswer" class="block text-sm text-gray-300">
          Bitte löse zur Verifikation: <span id="captchaQuestion"></span><span class="text-red-400">*</span>
        </label>
        <input type="number" inputmode="numeric" name="captcha_answer" id="captchaAnswer" class="w-full max-w-xs rounded-md bg-gray-800/60 border border-gray-700 px-4 py-2 text-gray-100 focus:outline-none focus:ring-2 focus:ring-brand-orange" required />
        <input type="hidden" id="captchaExpected" />
        <p id="captchaError" class="text-sm text-red-400 hidden">Antwort ist falsch. Bitte nochmal prüfen.</p>
      </div>

      <button type="submit" class="inline-block mt-2 rounded-lg bg-brand-orange px-6 py-3 font-semibold text-white shadow hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-orange">
        Bewerbung senden
      </button>
      <p class="text-xs text-gray-400">* Pflichtfelder</p>
    </form>

    <script>
      // time trap
      const startEl = document.getElementById('form_start_ms');
      if (startEl instanceof HTMLInputElement) {
        startEl.value = String(Date.now());
      }

      // simple math captcha
      const a = Math.floor(Math.random() * 7) + 2; // 2..8
      const b = Math.floor(Math.random() * 7) + 2; // 2..8
      const questionEl = document.getElementById('captchaQuestion');
      const expectedEl = document.getElementById('captchaExpected');
      if (questionEl) {
        questionEl.textContent = `${a} + ${b} = ?`;
      }
      if (expectedEl instanceof HTMLInputElement) {
        expectedEl.value = String(a + b);
      }

      // client-side gate on submit
      const form = document.getElementById('bewerbungForm');
      form?.addEventListener('submit', (e) => {
        const websiteEl = form.querySelector('input[name="website"]');
        const website = (websiteEl instanceof HTMLInputElement) ? websiteEl.value : '';
        if (website) {
          e.preventDefault(); // honeypot triggered
          return;
        }
        const startVal = (startEl instanceof HTMLInputElement) ? startEl.value : '0';
        const start = parseInt(startVal || '0', 10);
        const delta = Date.now() - start;
        if (delta < 5000) { // <5s → verdächtig
          e.preventDefault();
          alert('Bitte nimm dir einen Moment Zeit und versuche es erneut.');
          return;
        }
        const ansEl = document.getElementById('captchaAnswer');
        const expectedValEl = document.getElementById('captchaExpected');
        const ans = (ansEl instanceof HTMLInputElement) ? parseInt(ansEl.value || '0', 10) : 0;
        const expected = (expectedValEl instanceof HTMLInputElement) ? parseInt(expectedValEl.value || '0', 10) : 0;
        if (ans !== expected) {
          e.preventDefault();
          const err = document.getElementById('captchaError');
          err?.classList.remove('hidden');
        }
      });
    </script>
  </SectionWrapper>
</MainLayout>
